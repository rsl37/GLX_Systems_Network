# This workflow uses actions that are not certified by GitHub.
# They are provided by a third-party and are governed by
# separate terms of service, privacy policy, and support
# documentation.

# This workflow integrates njsscan with GitHub's Code Scanning feature
# nodejsscan is a static security code scanner that finds insecure code patterns in your Node.js applications

name: njsscan sarif

on:
  push:
    branches: ["main"]
  pull_request:
    # The branches below must be a subset of the branches above
    branches: ["main"]
  schedule:
    - cron: '39 1 * * 5'

permissions:
  contents: read

jobs:
  njsscan:
    permissions:
      contents: read # for actions/checkout to fetch code
      security-events: write # for github/codeql-action/upload-sarif to upload SARIF results
      actions: read # only required for a private repository by github/codeql-action/upload-sarif to get the Action run status
    runs-on: ubuntu-latest
    name: njsscan code scanning
    steps:
<<<<<<< HEAD
      - name: Checkout the code
        uses: actions/checkout@v4
      - name: nodejsscan scan
        id: njsscan
        uses: ajinabraham/njsscan-action@v9
        with:
          args: '. --sarif --output results.sarif || true'
      - name: Upload njsscan report
        uses: github/codeql-action/upload-sarif@v3
        continue-on-error: true
        id: upload-sarif
        with:
          sarif_file: results.sarif

      - name: Handle SARIF upload unavailable
        if: steps.upload-sarif.outcome == 'failure'
        run: |
          echo "⚠️ SARIF upload is not available for this repository."
          echo "This feature requires GitHub Advanced Security for private repositories."
          echo "The njsscan analysis was completed successfully, but results cannot be uploaded to GitHub's security tab."
          echo "Consider enabling GitHub Advanced Security or making the repository public to use this feature."

      - name: Upload njsscan results as artifact
        if: steps.upload-sarif.outcome == 'failure'
        uses: actions/upload-artifact@v4
        with:
          name: njsscan-results
          path: results.sarif
          retention-days: 7
=======
    - name: Checkout the code
      uses: actions/checkout@v4
    - name: nodejsscan scan
      id: njsscan
      uses: ajinabraham/njsscan-action@v9
      with:
        args: '. --sarif --output results.sarif || true'
    - name: Upload njsscan report
      uses: github/codeql-action/upload-sarif@v3
      with:
        sarif_file: results.sarif
>>>>>>> origin/copilot/fix-468
