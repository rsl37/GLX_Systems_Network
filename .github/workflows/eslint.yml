# This workflow provides TypeScript and code quality checking
# Since the project uses TypeScript with Vite, we'll focus on type checking
# rather than ESLint configuration which is not set up for this project

name: Code Quality

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  schedule:
    - cron: '37 23 * * 6'

jobs:
  type-check:
    name: TypeScript Type Checking
    runs-on: ubuntu-latest
    timeout-minutes: 10
    permissions:
      contents: read
      security-events: write
      actions: read
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20.x'
          cache: 'npm'
          cache-dependency-path: './GALAX_App_files/package-lock.json'

      - name: Install dependencies
        working-directory: ./GALAX_App_files
        run: npm ci --prefer-offline --no-audit --no-fund

      - name: TypeScript type check
        working-directory: ./GALAX_App_files
        run: |
          echo "Running TypeScript type checking..."
          npx tsc --noEmit --project ./tsconfig.json

      - name: Check for ESLint config
        working-directory: ./GALAX_App_files
        run: |
          echo "Checking for ESLint configuration..."
          if [ -f ".eslintrc.js" ] || [ -f ".eslintrc.json" ] || [ -f "eslint.config.js" ]; then
            echo "ESLint config found, running ESLint..."
            npx eslint . --ext .js,.jsx,.ts,.tsx --format json --output-file eslint-results.json || echo "ESLint completed with warnings"
            
            # Convert to SARIF if needed for security scanning
            if [ -f "eslint-results.json" ]; then
              echo "ESLint results generated"
            fi
          else
            echo "âœ“ No ESLint config found - skipping ESLint step"
            echo "Project uses TypeScript for type safety instead"
          fi

      - name: Upload analysis results (if available)
        if: hashFiles('GALAX_App_files/eslint-results.json') != ''
        uses: actions/upload-artifact@v4
        with:
          name: code-quality-results
          path: ./GALAX_App_files/eslint-results.json
          retention-days: 7
